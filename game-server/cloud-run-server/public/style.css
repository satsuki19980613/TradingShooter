/* ========================================
 * グローバル設定 & レイアウト
 * ======================================== */
body {
    font-family: 'Verdana', 'Noto Sans JP', sans-serif;
    background-color: #050a10; /* 全体の背景色をコックピットに合わせる */
    color: #f0f0f0;
    overflow: hidden;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    margin: 0;
    user-select: none;
}

/* ========================================
 * UIシェル (画面遷移・共通パネル)
 * ======================================== */
.screen {
    width: 100%;
    height: 100%;
    position: absolute;
    top: 0;
    left: 0;
    display: none; /* 初期状態は非表示 */
    justify-content: center;
    align-items: center;
    flex-direction: column;
    z-index: 50;
}
.screen.active {
    display: flex;
}

/* メニュー画面のコンテンツボックス */
.screen-content {
    display: flex;
    flex-direction: column;
    align-items: center;
    background-color: rgba(10, 25, 40, 0.85);
    border: 1px solid #00ffff30;
    padding: 60px;
    box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
    backdrop-filter: blur(8px);
    border-radius: 8px;
}

.screen-content h1 {
    margin-top: 0;
    margin-bottom: 40px;
    color: #00ffff;
    text-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
    letter-spacing: 2px;
}
.screen-content h2 {
    margin: 0 0 20px 0;
    color: #00ffff;
}
.screen-content input[type="text"] {
    background-color: rgba(0, 0, 0, 0.5);
    border: 1px solid #00ffff;
    color: white;
    padding: 10px;
    border-radius: 4px;
    font-size: 16px;
    width: 100%;
    box-sizing: border-box;
}

.screen-content p, 
.screen-content button {
    margin-top: 20px;
}

/* 汎用ボタン */
.ui-button {
    font-family: inherit;
    font-size: 16px;
    padding: 10px 30px;
    border: 1px solid #49a5a5;
    color: #00ffff;
    background-color: rgba(0, 20, 30, 0.6);
    border-radius: 4px;
    cursor: pointer;
    text-shadow: 0 0 5px rgba(0, 255, 255, 0.5);
    box-shadow: 0 0 10px rgba(0, 255, 255, 0.1), 
                inset 0 0 8px rgba(0, 255, 255, 0.1);
    transition: all 0.2s ease;
    width: 250px;
    text-align: center;
    text-transform: uppercase;
    letter-spacing: 1px;
}
.ui-button:hover {
    background-color: rgba(0, 255, 255, 0.2);
    color: #ffffff;
    box-shadow: 0 0 15px rgba(0, 255, 255, 0.4);
}
.ui-button.primary {
    background-color: rgba(0, 255, 255, 0.3);
    color: #ffffff;
    box-shadow: 0 0 20px rgba(0, 255, 255, 0.5), 
                inset 0 0 10px rgba(0, 255, 255, 0.2);
    border-color: #00ffff;
}
.ui-button.primary:hover {
    background-color: rgba(0, 255, 255, 0.5);
}
.ui-button.small {
    padding: 5px 15px;
    font-size: 12px;
    width: auto;
    margin-top: 10px;
}

/* ========================================
 * コックピット・レイアウト (修正版)
 * ======================================== */

/* 全体コンテナ */
#cockpit-container {
    display: flex;
    /* ▼▼▼ 追加/変更 ▼▼▼ */
    width: 100vw;   /* 画面幅いっぱい */
    height: 100vh;  /* 画面高さいっぱい */
    max-width: 100%;
    max-height: 100%;
    
    background-color: #050a10;
    padding: 10px;
    box-sizing: border-box;
    gap: 10px;
    
    /* 中央配置の設定は削除（画面いっぱいになるため不要） */
    margin: 0; 
}
/* パネル共通設定 */
.cockpit-panel {
    display: flex;
    flex-direction: column;
    gap: 10px;
    /* min-width: 0; <-- 削除 (これが縮む原因の一つ) */
}

/* サイドパネル (左右) */
.side-panel {
    /* ★重要: これで縮小を防ぐ */
    flex: 0 0 auto; 
    z-index: 20;
}

/* 左パネル */
#panel-left {

    width: 16%;       /* ★画面幅の22%を使用 */
    min-width: 250px; /* 小さくなりすぎないための最低幅 */
}

/* 右パネル */
#panel-right {

    
    width: 16%;       /* ★画面幅の16%を使用 */
    min-width: 150px; /* 小さくなりすぎないための最低幅 */
}
/* 中央パネル */
#panel-center {
    flex: 1 1 auto; /* 余ったスペースを埋める */
    position: relative;
    display: flex;
    flex-direction: column;
    gap: 10px;
    overflow: hidden;
    min-width: 400px; /* ゲーム画面が潰れすぎないように最低幅を保証 */
}

/* --- ゲーム画面エリア (上部) --- */
#game-field-wrapper {
    flex-grow: 1; /* 余った高さを全て使う */
    position: relative;
    background: #000;
    border: 1px solid #333;
    display: flex;
    justify-content: center;
    align-items: center;
    overflow: hidden;
    box-shadow: inset 0 0 20px rgba(0,0,0,0.8);
}

#game-field-container {
    width: 100%;
    height: 100%;
    position: relative;
}

/* Canvas レイヤー */
canvas#game-field {
    position: absolute;
    top: 0;
    left: 0;
    z-index: 1;
}
#obstacle-layer {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 10;
    pointer-events: none;
}
canvas#ui-field {
    position: absolute;
    top: 0;
    left: 0;
    z-index: 50;
    pointer-events: none;
}

/* --- チャートエリア (下部ワイド表示) --- */
#bottom-chart-panel {
    height: 25vh;      /* 画面の高さ(Viewport Height)の25%にする */
    min-height: 150px;
    width: 100%;
    flex-shrink: 0;
    position: relative;
    padding: 0;
    background: rgba(10, 20, 30, 0.9);
    border: 1px solid rgba(0, 255, 255, 0.2);
    /* フレックスボックスで横並び */
    display: flex; 
    flex-direction: row !important;
}
#bottom-chart-panel h3 {
    position: absolute;
    top: 0;
    left: 0;
    z-index: 10;
    margin: 0;
    background: rgba(0, 255, 255, 0.1);
    color: #00ffff;
    font-size: 10px;
    padding: 2px 8px;
    letter-spacing: 1px;
    border-bottom-right-radius: 4px;
}

/* ========================================
 * パネルモジュール (UIパーツの箱)
 * ======================================== */
.panel-module {
    background: rgba(10, 20, 30, 0.85);
    border: 1px solid rgba(0, 255, 255, 0.2);
    padding: 10px;
    border-radius: 4px;
    display: flex;
    flex-direction: column;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
    position: relative;
}

.panel-module h3 {
    margin: 0 0 8px 0;
    font-size: 12px;
    color: #00ffff;
    border-bottom: 1px solid rgba(0, 255, 255, 0.3);
    padding-bottom: 4px;
    letter-spacing: 2px;
    text-transform: uppercase;
}

/* Canvasを包む枠 */
.canvas-wrapper {
    width: 100%;
    position: relative;
    background: rgba(0, 0, 0, 0.3);
    /* border: 1px solid rgba(255, 255, 255, 0.05); */
    min-height: 100px;
}
.canvas-wrapper canvas {
    display: block;
    width: 100%;
    height: 100%;
}

/* --- シームレスモジュール (右パネル用: 枠なし) --- */
.panel-module.seamless-module {
    background: transparent;
    border: none;
    box-shadow: none;
    padding: 0;
}
.panel-module.seamless-module h3 {
    margin-bottom: 5px;
    padding-left: 5px;
    border-left: 3px solid #00ffff;
    border-bottom: none;
    background: linear-gradient(90deg, rgba(0,255,255,0.1), transparent);
    color: #00ffff;
}

/* ========================================
 * ステータス表示 (HP, EP, 数値)
 * ======================================== */
#hud-status-area .stat-row {
    display: flex;
    align-items: center;
    margin-bottom: 10px; /* 行間を広げる */
    font-size: 18px;    /* 16px -> 18px */
}
#hud-status-area .stat-label {
    width: 60px;
    color: #00ffff;
    text-shadow: 0 0 5px rgba(0, 255, 255, 0.5);
    font-weight: bold;
}
.stat-bar-outer {
    flex-grow: 1;
    height: 8px;
    background-color: rgba(0, 0, 0, 0.5);
    border: 1px solid #333;
    margin-right: 8px;
    padding: 1px;
}
.stat-bar {
    height: 100%;
    transition: width 0.2s ease-out;
}
.stat-bar.hp {
    background-color: #00bcd4;
    box-shadow: 0 0 5px #00bcd4;
}
.stat-value {
    width: 40px;
    text-align: right;
    font-family: 'Roboto Mono', monospace;
    color: #fff;
}

/* バーがない行 (Size, Power) のレイアウト */
.stat-row.no-bar {
    justify-content: space-between;
    padding-right: 2px;
}
.stat-row.no-bar .stat-value {
    width: auto;
    color: #fff;
    font-weight: bold;
}

/* ========================================
 * リーダーボード
 * ======================================== */
#hud-leaderboard-container {
    flex-grow: 1;
    overflow-y: auto;
}
#leaderboard-list {
    list-style: none;
    margin: 0;
    padding: 0;
    width: 100%;
    counter-reset: lb-rank;
}
.leaderboard-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 12px;
    margin-bottom: 5px;
    background: rgba(255, 255, 255, 0.05);
    font-size: 15px;    /* 14px -> 15px */
    border-radius: 2px;
}
.leaderboard-row:not(.empty)::before {
    counter-increment: lb-rank;
    content: counter(lb-rank);
    width: 20px;
    font-weight: bold;
    color: #aaa;
    text-align: center;
    font-family: 'Impact', sans-serif;
}
/* 順位色 */
.leaderboard-row:nth-child(1)::before { color: #FFD700; text-shadow: 0 0 5px #FFD700; }
.leaderboard-row:nth-child(2)::before { color: #C0C0C0; }
.leaderboard-row:nth-child(3)::before { color: #CD7F32; }

.lb-name {
    flex-grow: 1;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    margin: 0 10px;
    color: #ddd;
}
.lb-score {
    font-family: 'Roboto Mono', monospace;
    color: #00bcd4;
    font-weight: bold;
}
.leaderboard-row.you {
    background: rgba(0, 188, 212, 0.25);
    border: 1px solid rgba(0, 188, 212, 0.5);
}
.leaderboard-row.you .lb-name { color: #fff; font-weight: bold; }
.leaderboard-row.empty { opacity: 0.3; }

/* ========================================
 * その他のモーダル・画面
 * ======================================== */

/* モーダル共通 */
.ui-modal {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.8);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 300;
}
.ui-modal.hidden { display: none; }

.modal-content {
    background-color: #0a1928;
    border: 1px solid #ff9800;
    padding: 30px;
    border-radius: 8px;
    width: 350px;
    text-align: center;
    box-shadow: 0 0 30px rgba(255, 152, 0, 0.2);
}
.modal-content h3 { color: #ff9800; margin-top: 0; }

.account-section {
    margin-bottom: 20px;
    border-bottom: 1px solid #333;
    padding-bottom: 15px;
}
.account-section h4 { margin: 10px 0; font-size: 14px; color: #00bcd4; }

#transfer-code-display {
    font-family: monospace;
    font-size: 20px;
    background: #222;
    padding: 10px;
    margin: 10px 0;
    border: 1px dashed #555;
    color: #fff;
    letter-spacing: 3px;
}

/* 背景動画 */
#bg-video {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    z-index: -1;
    opacity: 0.6;
}

/* ユーティリティ */
.hidden { display: none !important; }

/* デバッグパネル */
#debug-panel {
    background: rgba(0,0,0,0.8);
    padding: 10px;
    border: 1px solid #555;
    font-family: monospace;
    font-size: 11px;
    margin-top: 10px;
}
#debug-panel h4 { margin: 0 0 5px 0; color: #ff9800; }

/* ========================================
 * 下部パネル (チャート & 操作説明) のレイアウト
 * ======================================== */

#bottom-chart-panel {
    flex-direction: row !important;
    padding: 0 !important;
}

#bottom-chart-left {
    position: relative;
    width: 57%;  /* ★変更: 50% -> 57% (チャートを広く) */
    height: 100%;
    border-right: 1px solid rgba(0, 255, 255, 0.2);
}
#ma-selection-panel {
    width: 8%;   /* ★変更: 15% -> 8% (余白を削減) */
    height: 100%;
    border-right: 1px solid rgba(0, 255, 255, 0.2);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: flex-start; /* 左寄せ */
    padding-left: 8px; /* ★変更: 15px -> 8px (内部余白も調整) */
    gap: 10px;
    background: rgba(0, 0, 0, 0.2);
}
.chart-label-badge {
    position: absolute;
    top: 0;
    left: 0;
    z-index: 10;
    margin: 0;
    background: rgba(0, 255, 255, 0.1);
    color: #00ffff;
    font-size: 11px; /* 少し大きく */
    padding: 3px 10px;
    letter-spacing: 1px;
    border-bottom-right-radius: 4px;
}
.ma-option {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 12px;
    font-weight: bold;
    cursor: pointer;
}
.ma-option input {
    cursor: pointer;
    accent-color: #00bcd4; /* ラジオボタンの色 */
}
.ma-option label {
    cursor: pointer;
    text-shadow: 0 0 2px rgba(255,255,255,0.5);
}
#control-area-right {
    width: 35%; /* 50% -> 35% に圧縮 */
    height: 100%;
    position: relative;
    overflow: hidden;
}

.control-bg-deco {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 20, 30, 0.5);
    z-index: 0;
}

.control-content {
    /* gap: 12px; <-- これを削除または0にする */
    gap: 0; 
    
    /* 以下は変更なし */
    position: relative;
    z-index: 1;
    padding: 10px 20px;
    height: 100%;
    box-sizing: border-box;
    display: flex;
    flex-direction: column;
    justify-content: center;
}
.control-header {
    margin: 0 0 5px 0;
    color: #888;
    font-size: 12px; /* 大きく */
    letter-spacing: 3px;
    border-bottom: 1px solid #444;
    text-align: center; /* 中央揃え */
}

.control-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    font-size: 14px;
    color: #ddd;
    font-weight: bold;

    /* ▼ 線と余白の設定（ここを調整） */
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    padding: 6px 0; /* 8pxだと少し大きいので6pxくらいが丁度良いです */
}

/* 一番下の行の線は消す */
.control-row:last-child {
    border-bottom: none;
}

/* キーキャップ共通 */
.key-cap {
    display: inline-block;
    padding: 4px 8px; /* 大きく */
    border-radius: 4px;
    border: 1px solid #aaa;
    font-family: 'Roboto Mono', monospace;
    font-weight: bold;
    min-width: 24px; /* 幅を確保 */
    text-align: center;
    font-size: 14px; /* 文字サイズアップ */
    box-shadow: 0 2px 0 rgba(0,0,0,0.5); /* 立体感 */
    text-shadow: 0 0 2px rgba(255,255,255,0.3);
}

/* WASD用の特殊レイアウト */
.wasd-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
}
.wasd-row {
    display: flex;
    gap: 4px;
}

/* 色バリエーション */
.key-cyan {
    border-color: #00ffff;
    color: #00ffff;
    background: rgba(0, 255, 255, 0.15);
    box-shadow: 0 0 5px rgba(0,255,255,0.2), 0 2px 0 rgba(0,0,0,0.5);
}

.key-red {
    border-color: #ff5252;
    color: #ff5252;
    background: rgba(255, 82, 82, 0.15);
    padding: 4px 12px;
}

.key-green {
    border-color: #00e676;
    color: #00e676;
    background: rgba(0, 230, 118, 0.15);
    padding: 4px 20px;
}

.key-green-text {
    color: #00e676;
    font-weight: bold;
    text-shadow: 0 0 5px rgba(0, 230, 118, 0.4);
}

.key-gray {
    border-color: #888;
    color: #eee;
    background: rgba(255,255,255,0.1);
}

.sub-text {
    font-size: 10px;
    color: #888;
    margin: 0 4px;
}


<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=no"
    />

    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover"
    />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />
    <title>TradingShooter</title>
    <link rel="stylesheet" href="style.css" />
    <link rel="stylesheet" href="https://trading-charge-shooter.web.app" />
  </head>
  <body>
    <video autoplay muted loop playsinline id="bg-video">
      <source
        src="https://trading-charge-shooter.web.app/bg_video.mp4"
        type="video/mp4"
      />
    </video>

    <div id="screen-home" class="screen active">
      <div class="screen-content">
        <h1>TradingShooter</h1>

        <div class="player-info-display">
          <p>
            Player:
            <span
              id="display-player-name"
              style="color: #00ffff; font-weight: bold"
              >Guest</span
            >
          </p>
        </div>

        <button id="btn-start-game" class="ui-button primary">Join Game</button>

        <button id="btn-goto-ranking" class="ui-button">Leaderboard</button>

        <button
          id="btn-menu-transfer"
          class="ui-button"
          style="border-color: #aaa; color: #ccc"
        >
          データ引継ぎ / 発行
        </button>

        <button
          id="btn-menu-register"
          class="ui-button"
          style="border-color: #ff9800; color: #ff9800"
        >
          プレイヤー登録
        </button>
      </div>
    </div>

    <div
      id="modal-initial"
      class="ui-modal hidden"
      style="background-color: rgba(0, 0, 0, 0.95)"
    >
      <div class="modal-content" style="width: 400px; border-color: #00bcd4">
        <h2 style="color: #00bcd4; margin-top: 0">Welcome</h2>

        <div style="margin: 20px 0">
          <input
            type="text"
            id="initial-name-input"
            placeholder="プレイヤー名 (変更不可)"
            maxlength="12"
            style="
              width: 100%;
              padding: 10px;
              font-size: 16px;
              box-sizing: border-box;
            "
          />
          <p style="color: #ff5252; font-size: 11px; margin-top: 5px">
            ※一度設定した名前は変更できません。
          </p>
          <button
            id="btn-initial-start"
            class="ui-button"
            style="width: 100%; margin-top: 10px"
          >
            決定
          </button>
        </div>
        <button
          id="btn-initial-guest"
          class="ui-button"
          style="width: 100%; margin-top: 15px"
        >
          ゲストプレイ
        </button>

        <div style="margin-top: 15px">
          <button
            id="btn-initial-goto-transfer"
            class="ui-button small"
            style="width: auto; font-size: 12px"
          >
            引継ぎコードをお持ちの方はこちら
          </button>
        </div>
      </div>
    </div>

    <div id="modal-transfer" class="ui-modal hidden">
      <div class="modal-content">
        <h3>データ引継ぎ</h3>

        <div class="account-section">
          <h4>データを復旧する</h4>
          <p style="font-size: 12px; color: #aaa">
            以前発行したコードを入力してください。
          </p>
          <input
            type="text"
            id="recover-code-input"
            placeholder="引継ぎコード"
            style="margin-bottom: 10px"
          />
          <button id="btn-do-recover" class="ui-button small primary">
            データを復旧
          </button>
        </div>

        <div
          class="account-section"
          style="
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px dashed #555;
          "
        >
          <h4>現在のデータを引き継ぐ</h4>
          <p style="font-size: 11px; color: #aaa">
            この端末のデータを他に移すためのコードを発行します。
          </p>
          <div id="transfer-code-display">------</div>
          <button id="btn-issue-code" class="ui-button small">
            コード発行
          </button>
        </div>

        <button
          id="btn-close-transfer"
          class="ui-button"
          style="margin-top: 20px"
        >
          戻る
        </button>
      </div>
    </div>

    <div id="modal-register" class="ui-modal hidden">
      <div class="modal-content">
        <h3 style="color: #ff9800">プレイヤー名登録</h3>
        <p style="font-size: 12px">
          ランキングに載る正式な名前を設定します。<br />設定後は変更できません。
        </p>

        <div style="margin: 20px 0">
          <input
            type="text"
            id="reg-name-input"
            placeholder="希望する名前 (英数字)"
            maxlength="12"
            style="width: 100%; padding: 10px"
          />
        </div>

        <button id="btn-do-register" class="ui-button primary">決定</button>
        <button
          id="btn-close-register"
          class="ui-button"
          style="margin-top: 10px"
        >
          戻る
        </button>
      </div>
    </div>

    <div id="screen-loading" class="screen">
      <div class="screen-content"><h2 id="loading-text">Loading...</h2></div>
    </div>
    <div id="screen-ranking" class="screen">
      <div class="screen-content">
        <div id="ranking-list" class="ranking-container"><p>Loading...</p></div>
        <button id="btn-ranking-back" class="ui-button">戻る</button>
      </div>
    </div>
    <div id="screen-game" class="screen">
      <div id="cockpit-container" class="overlay-layout">
        <div id="game-field-wrapper" class="full-screen-layer">
          <div id="game-field-container">
            <canvas id="game-field" tabindex="0"></canvas>
            <canvas
              id="ui-field"
              style="position: absolute; top: 0; left: 0; pointer-events: none"
            ></canvas>
            <div id="obstacle-layer"></div>
          </div>
        </div>
        <div id="hud-layer" class="full-screen-layer">
          <div class="hud-group top-left">
            <div class="panel-module transparent-bg">
              <h3>STATUS</h3>
              <div id="hud-status-area">
                <div class="stat-row">
                  <span class="stat-label">HP</span>
                  <div class="stat-bar-outer">
                    <div id="hp-bar-inner" class="stat-bar hp"></div>
                  </div>
                  <span id="hp-value" class="stat-value">100</span>
                </div>
                <div class="stat-row">
                  <span class="stat-label">EP</span>
                  <div
                    class="stat-bar-outer"
                    style="visibility: hidden; height: 0"
                  ></div>
                  <span id="ep-value" class="stat-value ep-value">100</span>
                </div>
                <div class="stat-row no-bar">
                  <span class="stat-label">Size</span>
                  <span id="size-value" class="stat-value">10</span>
                </div>
                <div class="stat-row no-bar">
                  <span class="stat-label" id="power-label">Power</span>
                  <span id="power-value" class="stat-value">0</span>
                </div>
              </div>
            </div>

            <div class="panel-module transparent-bg">
              <h3>LEADERBOARD</h3>
              <div id="hud-leaderboard-container">
                <ol id="leaderboard-list"></ol>
              </div>
            </div>
          </div>

          <div class="hud-group top-right">
            <div class="hud-row">
              <div class="panel-module transparent-bg">
                <h3>RADAR</h3>
                <div class="canvas-wrapper">
                  <canvas id="radar-canvas"></canvas>
                </div>
              </div>

              <div class="panel-module transparent-bg">
                <h3>MAGAZINE</h3>
                <div class="canvas-wrapper">
                  <canvas id="magazine-canvas"></canvas>
                </div>
              </div>
            </div>

            <button
              id="btn-retire"
              class="ui-button small"
              style="
                background-color: #d32f2f;
                width: auto;
                opacity: 0.8;
                font-size: 10px;
                padding: 2px 10px;
                margin-top: 0;
                align-self: flex-end; /* 右寄せ */
              "
            >
              RETIRE
            </button>
          </div>

          <div class="hud-group bottom-center">
            <div
              id="bottom-chart-panel"
              class="panel-module transparent-bg"
              style="width: 600px; height: 180px"
            >
              <div id="bottom-chart-left" style="width: 85%">
                <h3 class="chart-label-badge">MARKET CHART</h3>
                <div class="canvas-wrapper" style="height: 100%">
                  <canvas id="chart-canvas"></canvas>
                </div>
              </div>
              <div id="ma-selection-panel" style="width: 15%">
                <div class="ma-option">
                  <input
                    type="checkbox"
                    id="ma-short"
                    name="ma-select"
                    value="short"
                  />
                  <label for="ma-short" style="color: #00ffff">S</label>
                </div>
                <div class="ma-option">
                  <input
                    type="checkbox"
                    id="ma-medium"
                    name="ma-select"
                    value="medium"
                    checked
                  />
                  <label for="ma-medium" style="color: #ffff00">M</label>
                </div>
                <div class="ma-option">
                  <input
                    type="checkbox"
                    id="ma-long"
                    name="ma-select"
                    value="long"
                  />
                  <label for="ma-long" style="color: #ff00ff">L</label>
                </div>
              </div>
            </div>
          </div>

          <div class="hud-group bottom-left">
            <div
              id="debug-panel"
              class="ui-panel"
              style="display: none; background: rgba(0, 0, 0, 0.5)"
            >
              <h4>Stats</h4>
              <div id="debug-stats-container"></div>
              <hr />
              <div id="debug-simulation-container"></div>
            </div>
          </div>

          <div class="hud-group bottom-right"></div>
        </div>
        <div id="mobile-controls-layer">
          <div id="mc-left-bottom">
            <button id="mc-btn-fire">FIRE</button>
          </div>

          <div id="mc-right-bottom">
            <div id="mc-joystick-area">
              <div id="mc-joystick-knob"></div>
            </div>
            <button id="mc-btn-settle" class="mc-btn-entry">SETTLE</button>
            <button id="mc-btn-short" class="mc-btn-entry">SHORT</button>
            <button id="mc-btn-long" class="mc-btn-entry">LONG</button>

            <div id="mc-lot-control">
              <button id="mc-btn-lot-minus" class="mc-btn-lot">-</button>
              <div id="mc-lot-display">10</div>
              <button id="mc-btn-lot-plus" class="mc-btn-lot">+</button>
            </div>
          </div>
        </div>
        <div id="hud-layer" class="full-screen-layer"></div>
      </div>
    </div>

    <div id="screen-gameover" class="screen">
      <div class="screen-content">
        <h2>GAME OVER</h2>
        <p>Score: <span id="gameover-score">0</span></p>
        <p id="gameover-message">Saving...</p>
        <button id="btn-gameover-retry" class="ui-button primary">Retry</button>
        <button id="btn-gameover-home" class="ui-button">Home</button>
      </div>
    </div>
    <div id="screen-error" class="screen">
      <div class="screen-content">
        <h2>Error</h2>
        <p id="error-message"></p>
        <button id="btn-error-home" class="ui-button">Home</button>
      </div>
    </div>
    <div id="screen-idle-warning" class="screen">
      <div class="screen-content">
        <h2>Warning</h2>
        <p>アイドル状態のため切断されます。</p>
      </div>
    </div>
    <div id="screen-mobile-block" class="screen">
      <div class="screen-content" style="border-color: #f44336">
        <h2 style="color: #f44336">PC Only</h2>
        <p>PCブラウザからアクセスしてください。</p>
      </div>
    </div>

    <script
      src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js"
      type="module"
    ></script>
    <script
      src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js"
      type="module"
    ></script>
    <script
      src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js"
      type="module"
    ></script>
    <script src="src/main.js" type="module"></script>
  </body>
</html>
